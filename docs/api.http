# Pocket Ratings API — runnable examples
#
# Prerequisites:
# - Server running (e.g. pocketratings server start; default http://127.0.0.1:3099)
# - User registered via CLI (pocketratings user register --name ... --email ... --password ...)
# - For protected routes: run the Login request below; copy the "token" value from the response body into @token (above)
#
# HTTP Status Codes:
# - 200 OK: Successful GET, PUT, PATCH, DELETE requests
# - 201 Created: Successful POST request that creates a resource
# - 400 Bad Request: Validation errors, malformed requests
# - 403 Forbidden: Missing/invalid authentication token or authorization failure
# - 404 Not Found: Resource not found
# - 405 Method Not Allowed: Unsupported HTTP method for an endpoint
# - 409 Conflict: Business rule violations (e.g., deleting category with products)
#
# Protected Fields: id, created_at, updated_at, deleted_at cannot be set or modified by clients.
# These fields are managed automatically by the server.
#
# Use with the REST Client extension (humao.rest-client) in Cursor/VS Code: click "Send Request" above each request.

@baseUrl = http://127.0.0.1:3099
@token = 

# Placeholder IDs: replace with real IDs from create/list responses when testing
@categoryId = 00000000-0000-0000-0000-000000000001
@locationId = 00000000-0000-0000-0000-000000000002
@productId = 00000000-0000-0000-0000-000000000003
@purchaseId = 00000000-0000-0000-0000-000000000004
@reviewId = 00000000-0000-0000-0000-000000000005

### Version

# GET /api/v1/version — Returns API version (no auth required)
GET {{baseUrl}}/api/v1/version

###

### Auth

# POST /api/v1/auth/login — Body: { email, password }. Returns { "token": "..." }. Copy token into @token for protected routes.
POST {{baseUrl}}/api/v1/auth/login
Content-Type: application/json

{
  "email": "alice@example.com",
  "password": "secret"
}

###

# GET /api/v1/me — Returns current user id and name. Requires Authorization: Bearer {{token}}.
GET {{baseUrl}}/api/v1/me
Authorization: Bearer {{token}}

### Categories

# GET /api/v1/categories — List all (root/flat). Optional: ?parent_id=uuid for children of a category.
GET {{baseUrl}}/api/v1/categories
Authorization: Bearer {{token}}

###

# GET /api/v1/categories?parent_id=uuid — List children of a category (replace uuid with real category id)
# GET {{baseUrl}}/api/v1/categories?parent_id={{categoryId}}
# Authorization: Bearer {{token}}

###

# GET /api/v1/categories/:id
GET {{baseUrl}}/api/v1/categories/{{categoryId}}
Authorization: Bearer {{token}}

###

# POST /api/v1/categories — Body: { name, parent_id? }
# Note: id, created_at, updated_at, deleted_at are protected fields (cannot be set)
POST {{baseUrl}}/api/v1/categories
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Groceries"
}

###

# PATCH /api/v1/categories/:id — Body: { name?, parent_id? }
# Note: id, created_at, updated_at, deleted_at are protected fields (cannot be modified)
PATCH {{baseUrl}}/api/v1/categories/{{categoryId}}
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Groceries (renamed)"
}

###

# DELETE /api/v1/categories/:id — Soft-delete. Add ?force=true for hard delete. 409 if category has children or products.
DELETE {{baseUrl}}/api/v1/categories/{{categoryId}}
Authorization: Bearer {{token}}

###

# DELETE /api/v1/categories/:id?force=true — Hard delete (permanent)
# DELETE {{baseUrl}}/api/v1/categories/{{categoryId}}?force=true
# Authorization: Bearer {{token}}

### Locations

# GET /api/v1/locations
GET {{baseUrl}}/api/v1/locations
Authorization: Bearer {{token}}

###

# GET /api/v1/locations/:id
GET {{baseUrl}}/api/v1/locations/{{locationId}}
Authorization: Bearer {{token}}

###

# POST /api/v1/locations — Body: { name }
# Note: id, deleted_at are protected fields (cannot be set)
POST {{baseUrl}}/api/v1/locations
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Local supermarket"
}

###

# PATCH /api/v1/locations/:id — Body: { name }
# Note: id, deleted_at are protected fields (cannot be modified)
PATCH {{baseUrl}}/api/v1/locations/{{locationId}}
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Corner store"
}

###

# DELETE /api/v1/locations/:id — Soft-delete. Add ?force=true for hard delete. 409 if location has purchases.
DELETE {{baseUrl}}/api/v1/locations/{{locationId}}
Authorization: Bearer {{token}}

###

# DELETE /api/v1/locations/:id?force=true — Hard delete (permanent)
# DELETE {{baseUrl}}/api/v1/locations/{{locationId}}?force=true
# Authorization: Bearer {{token}}

### Products

# GET /api/v1/products — Query: ?category_id=uuid, ?q=search
GET {{baseUrl}}/api/v1/products
Authorization: Bearer {{token}}

###

# GET /api/v1/products/:id
GET {{baseUrl}}/api/v1/products/{{productId}}
Authorization: Bearer {{token}}

###

# POST /api/v1/products — Body: { name, brand, category_id }
# Note: id, created_at, updated_at, deleted_at are protected fields (cannot be set)
POST {{baseUrl}}/api/v1/products
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Organic milk",
  "brand": "Dairy Co",
  "category_id": "{{categoryId}}"
}

###

# PATCH /api/v1/products/:id — Body: { name?, brand?, category_id? }
# Note: id, created_at, updated_at, deleted_at are protected fields (cannot be modified)
PATCH {{baseUrl}}/api/v1/products/{{productId}}
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Organic milk 1L"
}

###

# DELETE /api/v1/products/:id — Soft-delete. 409 Conflict if product has purchases.
DELETE {{baseUrl}}/api/v1/products/{{productId}}
Authorization: Bearer {{token}}

### Purchases

# GET /api/v1/purchases — Query: ?user_id=uuid, ?product_id=uuid, ?location_id=uuid, ?from=date, ?to=date
GET {{baseUrl}}/api/v1/purchases
Authorization: Bearer {{token}}

###

# GET /api/v1/purchases/:id
GET {{baseUrl}}/api/v1/purchases/{{purchaseId}}
Authorization: Bearer {{token}}

###

# POST /api/v1/purchases — Body: { product_id, location_id, quantity?, price, purchased_at? }
# Note: id, user_id, deleted_at are protected fields (cannot be set; user_id is set automatically)
POST {{baseUrl}}/api/v1/purchases
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "product_id": "{{productId}}",
  "location_id": "{{locationId}}",
  "quantity": 1,
  "price": "2.99",
  "purchased_at": "2025-02-15T12:00:00Z"
}

###

# DELETE /api/v1/purchases/:id — Soft-delete
DELETE {{baseUrl}}/api/v1/purchases/{{purchaseId}}
Authorization: Bearer {{token}}

### Reviews

# GET /api/v1/reviews — Query: ?product_id=uuid, ?user_id=uuid
GET {{baseUrl}}/api/v1/reviews
Authorization: Bearer {{token}}

###

# GET /api/v1/reviews/:id
GET {{baseUrl}}/api/v1/reviews/{{reviewId}}
Authorization: Bearer {{token}}

###

# POST /api/v1/reviews — Body: { product_id, rating, text? }
# Note: id, user_id, created_at, updated_at, deleted_at are protected fields (cannot be set; user_id is set automatically)
POST {{baseUrl}}/api/v1/reviews
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "product_id": "{{productId}}",
  "rating": 4.5,
  "text": "Good value."
}

###

# PATCH /api/v1/reviews/:id — Body: { rating?, text? }. Only own review.
# Note: id, user_id, created_at, updated_at, deleted_at are protected fields (cannot be modified)
PATCH {{baseUrl}}/api/v1/reviews/{{reviewId}}
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "rating": 5,
  "text": "Excellent."
}

###

# DELETE /api/v1/reviews/:id — Soft-delete. Only own review.
DELETE {{baseUrl}}/api/v1/reviews/{{reviewId}}
Authorization: Bearer {{token}}
